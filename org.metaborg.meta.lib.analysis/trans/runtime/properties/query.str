module runtime/properties/query

imports
	
	runtime/index/query
	runtime/nabl/uri
	runtime/task/core
	runtime/properties/entries
  runtime/properties/tasks
  runtime/properties/interface
  runtime/nabl/interface
  libspoofax/term/annotation

rules

  get-property-task(|kind) =
     map(get-property-task(|kind))
  <+ get-annos
   ; fetch-elem(?(kind, <id>))
    
rules
  
  get-property(|kind) =
    (get-property-task(|kind) <+ try(nabl-get-name); get-index-property(|kind))
  ; try(task-result-combinations-single; Hd) // Try because results may already be inserted? 
	
  get-properties(|kind) =
    (get-property-task(|kind) <+ try(nabl-get-name); get-index-properties(|kind))
  ; try(task-result-combinations-single; concat)
	
  get-index-property(|kind) =
    nabl-uris // TODO: how to handle multiple values?
  ; fetch-elem(!Prop(<id>, kind); index-get-one-value)
   
  get-index-properties(|kind) =
    nabl-uris // TODO: how to handle multiple values?
  ; mapconcat(!Prop(<id>, kind); index-get-all-values)

rules
	
	property-remove-all = topdown(try(remove-annotations(?(_, _))))
